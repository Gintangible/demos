function init(){clear(),gameOver=!1,black=!0;for(var o=0;o<count;o++)myWin[o]=0,computerWin[o]=0;for(var o=0;o<15;o++){mogokuBoard[o]=[];for(var r=0;r<15;r++)mogokuBoard[o][r]=0}var t=new Image;t.src="img/logo_bg.jpg",t.onload=function(){ctx.drawImage(t,0,0,450,450),setTransparent(),drawMogokuBoard()}}function startGame(){$(".gameStart").hide(),init()}function quitGame(){window.confirm("点击“确定”留在此页，“取消”刷新页面重新答题！")||(window.location=window.location.href)}function setTransparent(){for(var o=ctx.getImageData(0,0,450,450),r=o.data,t=0;t<r.length;t+=4){var n=r[t],a=r[t+1],i=r[t+2],e=r[t+3];r[t]=n,r[t+1]=a,r[t+2]=i,r[t+3]=.2*e}ctx.putImageData(o,0,0)}function drawMogokuBoard(){ctx.beginPath();for(var o=0;o<15;o++)ctx.moveTo(15+30*o,15),ctx.lineTo(15+30*o,435),ctx.stroke(),ctx.moveTo(15,15+30*o),ctx.lineTo(435,15+30*o),ctx.stroke();ctx.closePath()}function player(o){if(!gameOver&&black){var r=o.offsetX,t=o.offsetY,n=Math.floor(r/30),a=Math.floor(t/30);if(0==mogokuBoard[n][a]){oneStep(n,a,black),mogokuBoard[n][a]=1;for(var i=0;i<count;i++)wins[n][a][i]&&(myWin[i]++,computerWin[i]=6,5==myWin[i]&&gameEnd("player"));gameOver||(black=!black,computerAI())}}}function gameEnd(o){gameOver=!0,$(".gameStart").show(),$("#word").html(o+"<br/>win"),wordShow(),$(".gameStart").css({background:"url(img/end_bg.jpg) no-repeat","background-position":"right","background-size":"100% 100%"}),$("#result").css({"line-height":"1.3em"}),$(".begin").text("再来一局！")}function wordShow(){function o(){$("#result").html(word.substring(0,index++))}word=$("#word").html(),index=0,setInterval(o,500)}function clear(){ctx.clearRect(0,0,gomoku.width,gomoku.height)}$(function(){wordShow()});for(var mogokuBoard=[],black,gameOver,wins=[],myWin=[],computerWin=[],i=0;i<15;i++){wins[i]=[];for(var j=0;j<15;j++)wins[i][j]=[]}for(var count=0,i=0;i<15;i++)for(var j=0;j<11;j++){for(var k=0;k<5;k++)wins[i][j+k][count]=!0;count++}for(var i=0;i<15;i++)for(var j=0;j<11;j++){for(var k=0;k<5;k++)wins[j+k][i][count]=!0;count++}for(var i=0;i<11;i++)for(var j=0;j<11;j++){for(var k=0;k<5;k++)wins[i+k][j+k][count]=!0;count++}for(var i=0;i<11;i++)for(var j=14;j>3;j--){for(var k=0;k<5;k++)wins[i+k][j-k][count]=!0;count++}$(".begin").click(function(){startGame()}),$(".quit").click(function(){quitGame()});var gomoku=document.getElementById("gomoku"),ctx=gomoku.getContext("2d");ctx.strokeStyle="#BFBFBF";var oneStep=function(o,r,t){ctx.beginPath(),ctx.arc(15+30*o,15+30*r,13,0,2*Math.PI),ctx.closePath();var n=ctx.createRadialGradient(15+30*o,15+30*r,13,15+30*o,15+30*r,0);t?(n.addColorStop(0,"#0A0A0A"),n.addColorStop(1,"#636766")):(n.addColorStop(0,"#D1D1D1"),n.addColorStop(1,"#F9F9F9")),ctx.fillStyle=n,ctx.fill()};gomoku.onclick=function(o){player(o)};var computerAI=function(){for(var o=[],r=[],t=0,n=0,a=0,i=0;i<15;i++){o[i]=[],r[i]=[];for(var e=0;e<15;e++)o[i][e]=0,r[i][e]=0}for(var i=0;i<15;i++)for(var e=0;e<15;e++)if(0==mogokuBoard[i][e]){for(var c=0;c<count;c++)wins[i][e][c]&&(1==myWin[c]?o[i][e]+=200:2==myWin[c]?o[i][e]+=400:3==myWin[c]?o[i][e]+=2e3:4==myWin[c]&&(o[i][e]+=1e4),1==computerWin[c]?r[i][e]+=220:2==computerWin[c]?r[i][e]+=420:3==computerWin[c]?r[i][e]+=2100:4==computerWin[c]&&(r[i][e]+=2e4));o[i][e]>t?(t=o[i][e],n=i,a=e):o[i][e]==t&&r[i][e]>r[n][a]&&(n=i,a=e),r[i][e]>t?(t=r[i][e],n=i,a=e):r[i][e]==t&&o[i][e]>o[n][a]&&(n=i,a=e)}oneStep(n,a,!1),mogokuBoard[n][a]=2;for(var c=0;c<count;c++)wins[n][a][c]&&(computerWin[c]++,myWin[c]=6,5==computerWin[c]&&gameEnd("computer"));gameOver||(black=!black)};